
<!DOCTYPE html>
<!--[if IE 8]>         <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <title>PatternAgents: Device Tree Overview</title>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />

  <meta name="robots"          content="index, follow, noodp, noydir" />
  <meta name="description"     content="PatternAgents: The Agency of Design Patterns" />
  <meta name="abstract"        content="PatternAgents provides collaboration, community and commerce for electronics designers." />
  <meta name="classification"  content="electronics, electronics design, design engineering" />
  <meta name="keywords"        content="electronics, electronics design, design engineering, open source software, open source hardware, OSHW" />

  <link rel="apple-touch-icon" type="image/png" href="/img/logos/apple-touch-icon-144x144.png" />
  <!--  <link rel="icon" type="image/png" href="http://www/patternagents.com/img/logos/apple-touch-icon.png"/>  -->

  <!-- Ubuntu for logo -->
  <link href='http://fonts.googleapis.com/css?family=Ubuntu:400,700' rel='stylesheet' type='text/css'>

<!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/app-old-ie.css">
<![endif]-->
<!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/app.css">
<!--<![endif]-->
  
<!-- Begin MailChimp Signup Form -->
 <link href="//cdn-images.mailchimp.com/embedcode/classic-081711.css" rel="stylesheet" type="text/css">
 <style type="text/css">
	#mc_embed_signup{position:absolute; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,.8); display:block; z-index:10000; }
	#mc_embed_signup form{position:fixed; top:5%; left:5%; right:5%; bottom:5%; width:60%; font:normal 100% Helvetica,Arial,sans-serif; font-size:14px; border-radius:4px; border:3px; padding:10px; background-color:#eee; color:#000; text-align:left;max-height:800px;overflow-y:auto;overflow-x:hidden;}
	#mc_embed_signup a.mc_embed_close{background:transparent url(http://downloads.mailchimp.com/img/closebox.png) no-repeat; display:block; height:30px; width:30px; text-indent:-999em; position:absolute; top:10px; right:10px; display:none; }
 </style>

<!-- Begin Google Analytics -->
 <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38592761-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  </script>

</head>

<body class="">
 




















<header>
  <div class="head-container">
	  <div class="col">
	    <a href="/">
	      <h1>Pattern&#8203;<b>Agents</b> <span class="tag-line">Connecting the electronics design community</span></h1>
	    </a>
	  </div>
  </div>
</header>



<div class="row"><div class="col">
<nav class="toggle">
  <h2><a href="#" title="(click to expand)"><span class="menu-icon">&#9776;</span> Go to:</a></h2>
  <ul>
    <li class="nav-store"><a href="/store/index.html">Store</a></li>
    <li class="nav-projects"><a href="/projects/index.html">Projects</a></li>
    <li class="nav-support"><a href="/support/index.html">Support</a></li>
    <li class="nav-about"><a href="/about/index.html">About</a></li>
    <li class="nav-news"><a href="/news/index.html">News</a></li>
  </ul>
</nav>
</div></div>


  

<main class="row">
  
  <div class="col major">
    
  
  <article role="article">
    <header>
      
        <h1 class="entry-title">Device Tree Overview</h1>
      
      
        <p class="meta">
          
        </p>
      
    </header>
    <div class="entry-content">
  
  
  

<blockquote>
	<p>In nature, nothing is perfect and everything is perfect. Trees can be contorted, bent in weird ways, and they're still beautiful.</p>
	<p>&mdash;Alice Walker</p>
</blockquote>

<p>Recently, I've been working with the <a href="http://www.devicetree.org/">Device Tree</a> format,
which is becoming widely used for automatically configuring the hardware of embedded computing platforms like the Beaglebone Black,
Xilinx Zynq, Altera Arria, and many other System-on-Chip (SOC) devices. The <a href="http://www.devicetree.org/">Device Tree</a> 
is read during the computing platform boot up sequence, and it describes all the hardware of the embedded computing platform. 
It contains descriptions of all the platform parameters, like how much memory, what kind of interfaces, 
how many peripherals, etc. are expected to be present in that make and model of platform.
In this article, I'll introduce the <a href="http://www.devicetree.org/">Device Tree</a> format, 
and discuss how it is being used on current embedded computing platforms.  
</p>
<!-- more -->
<p>
<h2>What are Device Trees?</h2>
A <a href="http://www.devicetree.org/">Device Tree</a> is a data structure 
for describing the heirarchy of hardware subsystems within a computing platform,  or an add-on peripheral to that platform. 
It can be used to automatically select and configure the device drivers for that computing platform. 
A <a href="http://www.devicetree.org/">Device Tree</a> can be represented in several formats,
such as the human readable "Device Tree Source" format, or the compact, binary, "Flattened Device Tree" format. 
</p>
<p>
<h2>Why Device Tree?</h2>
<img class="illo" src="/img/news/devicetree/device-tree-nodes.png" alt="Example Device Tree Nodes" title="Example Device Tree Nodes"/>
As many new and different System-on-Chip (SOC) based embedded computing platforms started appearing a few years ago, 
it became increasingly difficult to support all the various operating system configurations required
for Linux, IOS, Windows, and others.
</p>
<p>
Prior to the adoption of the <a href="http://www.devicetree.org/">Device Tree</a> format,
this platform information was contained in what is known as the 
<a href="http://en.wikipedia.org/wiki/Board_support_package">Board Support Package (BSP)</a>,
a group of files provided by the manufacturer of that particular board.
Each new operating system version would need to include the hardware configuration information
from the <a href="http://en.wikipedia.org/wiki/Board_support_package">Board Support Package (BSP)</a>
in order to be able to run on that particular board. This quickly became a bottleneck in the process
of supporting new computing platforms that had only minor variations, so Linus Torvalds and others needed to 
<a href="http://article.gmane.org/gmane.linux.ports.arm.omap/55060">push back</a>, 
and come up with a more dynamic method of describing the hardware of the computing platform. 
</p>
<p>
The <a href="http://www.devicetree.org/">Device Tree</a> format was adopted to serve as the container format
for hardware configuration information required during the boot process, however a way was still needed to
modify the system after the boot up process, and to support expansion boards and subsystems.
Pantelis Antoniu, Grant Likely, and others have outlined a solution that
allows for <a href="https://lkml.org/lkml/2013/1/7/366">Device Tree Overlays</a>, and an 
<a href="https://lkml.org/lkml/2013/1/7/366">expansion board (Cape) manager</a>
to modify the <a href="http://www.devicetree.org/">Device Tree</a> from user-space, during run-time.
This allows users to load and unload hardware peripherals and drivers as needed.
The transition away from solely using <a href="http://en.wikipedia.org/wiki/Board_support_package">Board Support Package (BSP)</a> 
files to the <a href="http://www.devicetree.org/">Device Tree</a> format is ongoing,
and <a href="http://elinux.org/images/5/5c/ELCE2013_-_DT_War.pdf">not without it's share of problems</a>.
</p>
<p>
<h2>Embedded Device Trees</h2>
So, what is an embedded device tree, and how do we describe it?
Let's look at a common example, say the  <a href="http://beagleboard.org/BLACK">BeagleBone Black</a>, which uses an OMAP3 System-on-Chip from Texas Instruments.
A very (very) simplified example, including just the CPU and it's main memory, would look something like this :
</p>
<p>
<table>
<tr>
<td>&nbsp;</td>
<td>
<img src="/img/news/sff/beagleboneblack.png" alt="BeagleBone Black" title="BeagleBone Black"/>
</td>
<td>&nbsp;&nbsp;&nbsp;&nbsp;</td>
<td>
<img src="/img/news/devicetree/device-tree-bbb.png" alt="BeagleBone Black Device Tree" title="BeagleBone Black Device Tree"/>
</td>
<td>&nbsp;</td>
</tr>
</table>
</p>
<p>
The corresponding <a href="http://www.devicetree.org/">Device Tree Source (.dts)</a> file for the above would look something like :
<figure class="highlight"><pre><code class="language-c" data-lang="c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16</pre></td><td class="code"><pre><span class="p">{</span>
        <span class="n">model</span>      <span class="o">=</span> <span class="s">"TI AM335x BeagleBone Black"</span><span class="p">;</span>
        <span class="n">compatible</span> <span class="o">=</span> <span class="s">"ti,beaglebone-black"</span><span class="p">,</span>
                     <span class="s">"ti,am335x-boneblack"</span><span class="p">,</span>
                     <span class="s">"ti,am335x-bone"</span><span class="p">,</span>
                     <span class="s">"ti,am33xx"</span><span class="p">;</span>
        <span class="n">cpus</span> <span class="p">{</span>
                <span class="n">cpu</span><span class="err">@</span><span class="mi">0</span> <span class="p">{</span>
                       <span class="n">cpu0</span><span class="o">-</span><span class="n">supply</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">dcdc2_reg</span><span class="o">&gt;</span><span class="p">;</span>	
                <span class="p">};</span>	
        <span class="p">};</span>	
        <span class="n">memory</span> <span class="p">{</span>	
                <span class="n">device_type</span> <span class="o">=</span> <span class="s">"memory"</span><span class="p">;</span>
                <span class="n">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0x80000000</span> <span class="mh">0x10000000</span><span class="o">&gt;</span><span class="p">;</span> <span class="cm">/* 256 MB */</span>	
        <span class="p">};</span>
<span class="p">};</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>
</p>
<p>
As we can see from the above <a href="http://www.devicetree.org/">Device Tree Source (.dts)</a> example, we have defined the following :
<ul>
<li>model &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : defines the model name of this board</li>
<li>compatible : defines the manufacturer & model compatibility list</li>
<li>cpus &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: defines a single cpu with a node name of "cpu", and what power supply it uses</li>
<li>memory &nbsp; &nbsp; &nbsp; : defines 256 MegaBytes of main memory on this model, and it's address range</li>
</ul>
Of course, the actual Device Tree Source (.dts) file, in this case, the 
<a href="http://git.ti.com/wilink8-wlan/wilink8-wlan-ti-linux-kernel/blobs/9bf81aa9157a358fa53ab015e01c08bc68788709/arch/arm/boot/dts/am335x-bone-common.dtsi">am335x-bone-common.dtsi</a> include file has much more detail, but I'll build up the concepts gradually using simplified snippets.
</p>
<p>
Next we'll add some input/output to the Device Tree Source (.dts) file, and we'll start with a simple I2C controller
in order to create a tiny, but useful little computing platform description : 
<figure class="highlight"><pre><code class="language-c" data-lang="c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></td><td class="code"><pre><span class="p">{</span>
        <span class="n">model</span>      <span class="o">=</span> <span class="s">"TI AM335x BeagleBone Black"</span><span class="p">;</span>
        <span class="n">compatible</span> <span class="o">=</span> <span class="s">"ti,beaglebone-black"</span><span class="p">,</span>
                     <span class="s">"ti,am335x-boneblack"</span><span class="p">,</span>
                     <span class="s">"ti,am335x-bone"</span><span class="p">,</span>
                     <span class="s">"ti,am33xx"</span><span class="p">;</span>
        <span class="n">cpus</span> <span class="p">{</span>
                <span class="n">cpu</span><span class="err">@</span><span class="mi">0</span> <span class="p">{</span>
                       <span class="n">cpu0</span><span class="o">-</span><span class="n">supply</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">dcdc2_reg</span><span class="o">&gt;</span><span class="p">;</span>	
                <span class="p">};</span>	
        <span class="p">};</span>	
        <span class="n">memory</span> <span class="p">{</span>	
                <span class="n">device_type</span> <span class="o">=</span> <span class="s">"memory"</span><span class="p">;</span>
                <span class="n">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0x80000000</span> <span class="mh">0x10000000</span><span class="o">&gt;</span><span class="p">;</span> <span class="cm">/* 256 MB */</span>	
        <span class="p">};</span>
        <span class="n">am33xx_pinmux</span><span class="o">:</span> <span class="n">pinmux</span><span class="err">@</span><span class="mf">44e10800</span> <span class="p">{</span>
		<span class="n">pinctrl</span><span class="o">-</span><span class="n">names</span> <span class="o">=</span> <span class="s">"default"</span><span class="p">;</span>
		<span class="n">pinctrl</span><span class="o">-</span><span class="mi">0</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">clkout2_pin</span><span class="o">&gt;</span><span class="p">;</span>
		<span class="n">i2c0_pins</span><span class="o">:</span> <span class="n">pinmux_i2c0_pins</span> <span class="p">{</span>
			<span class="n">pinctrl</span><span class="o">-</span><span class="n">single</span><span class="p">,</span><span class="n">pins</span> <span class="o">=</span> <span class="o">&lt;</span>
                                <span class="cm">/* i2c0_sda.i2c0_sda pin */</span>
				<span class="mh">0x188</span> <span class="p">(</span><span class="n">PIN_INPUT_PULLUP</span> <span class="o">|</span> <span class="n">MUX_MODE0</span><span class="p">)</span>
				<span class="cm">/* i2c0_scl.i2c0_scl */</span>
				<span class="mh">0x18c</span> <span class="p">(</span><span class="n">PIN_INPUT_PULLUP</span> <span class="o">|</span> <span class="n">MUX_MODE0</span><span class="p">)</span>
			<span class="o">&gt;</span><span class="p">;</span>
		<span class="p">};</span>
        <span class="p">};</span>
        <span class="n">ocp</span> <span class="p">{</span>
		<span class="n">i2c0</span><span class="o">:</span> <span class="n">i2c</span><span class="err">@</span><span class="mf">44e0</span><span class="n">b000</span> <span class="p">{</span>
			<span class="n">pinctrl</span><span class="o">-</span><span class="n">names</span> <span class="o">=</span> <span class="s">"default"</span><span class="p">;</span>
			<span class="n">pinctrl</span><span class="o">-</span><span class="mi">0</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="n">i2c0_pins</span><span class="o">&gt;</span><span class="p">;</span>
			<span class="n">status</span> <span class="o">=</span> <span class="s">"okay"</span><span class="p">;</span>
			<span class="n">clock</span><span class="o">-</span><span class="n">frequency</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">400000</span><span class="o">&gt;</span><span class="p">;</span>
			<span class="n">tps</span><span class="o">:</span> <span class="n">tps</span><span class="err">@</span><span class="mi">24</span> <span class="p">{</span>
				<span class="n">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0x24</span><span class="o">&gt;</span><span class="p">;</span>
			<span class="p">};</span>
        <span class="p">};</span>
<span class="p">};</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>
</p>
<p>
The first thing we added above is the I/O Pin Multiplexing defintions, as most modern System-on-Chip (SoC) devices have several
functions available per pin for application flexibility. We need to define what pins are going to be used to connect the 
<a href="http://en.wikipedia.org/wiki/I%C2%B2C">I2C</a> controller to the outside world.
<ul>
<li>am33xx_pinmux: the label for the pin multiplexing control registers (pinmux) at address 0x44e10800 </li>
<li>i2c0_pins : the label for the pins assigned to the <a href="http://en.wikipedia.org/wiki/I%C2%B2C">I2C</a> Controller at offsets 0x188 and 0x18C</li>
</ul>
</p>
<p>
The next section defines the <a href="http://en.wikipedia.org/wiki/I%C2%B2C">I2C</a> controller itself, which is located on the 
<a href="http://en.wikipedia.org/wiki/Open_Core_Protocol">OCP bus (Open Core Protocol)</a>
which is the name for one of internal bus connections in the System-on-Chip (SoC):
<ul>
<li>i2c0: the label for the first I2C controller block at address 0x44e0b000 </li>
<li>status: we expect the I2C controller block status to be operational</li>
<li>clock-frequency: the I2C bus is running at 400Khz</li>
</ul>
<p>
And finally, we describe a sub-node of the <a href="http://en.wikipedia.org/wiki/I%C2%B2C">I2C</a> 
controller (i.e. an attached I2C device), called "tps":
<li>tps: the label for the power supply controller chip</li>
<li>reg: the I2C bus address for the "tps" device is 0x24 
<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (this is a "subnode" or indirect address)</li>
</ul>
</p>
<p>
Alright, now we need to define the "tps" node to make this a more complete <a href="http://www.devicetree.org/">Device Tree Source (.dts)</a> file,
which allows me to introduce the concept of power supply descriptions. It is really useful to know how much power that the power supplies on
a board are capable of providing, and what additional power that expansion devices or add-on boards will require. 
That will allow us to indicate an error if an expansion device requires more power than we are capable of providing.

<figure class="highlight"><pre><code class="language-c" data-lang="c"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></td><td class="code"><pre><span class="o">/</span><span class="n">include</span><span class="o">/</span> <span class="s">"tps65217.dtsi"</span>
<span class="o">&amp;</span><span class="n">tps</span> <span class="p">{</span>
	<span class="n">regulators</span> <span class="p">{</span>
		<span class="n">dcdc1_reg</span><span class="o">:</span> <span class="n">regulator</span><span class="err">@</span><span class="mi">0</span> <span class="p">{</span>
			<span class="n">regulator</span><span class="o">-</span><span class="n">always</span><span class="o">-</span><span class="n">on</span><span class="p">;</span>
		<span class="p">};</span>
		<span class="n">dcdc2_reg</span><span class="o">:</span> <span class="n">regulator</span><span class="err">@</span><span class="mi">1</span> <span class="p">{</span>
			<span class="n">regulator</span><span class="o">-</span><span class="n">name</span> <span class="o">=</span> <span class="s">"vdd_mpu"</span><span class="p">;</span>
			<span class="n">regulator</span><span class="o">-</span><span class="n">min</span><span class="o">-</span><span class="n">microvolt</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">925000</span><span class="o">&gt;</span><span class="p">;</span>
			<span class="n">regulator</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">microvolt</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">1325000</span><span class="o">&gt;</span><span class="p">;</span>
			<span class="n">regulator</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">on</span><span class="p">;</span>
			<span class="n">regulator</span><span class="o">-</span><span class="n">always</span><span class="o">-</span><span class="n">on</span><span class="p">;</span>
		<span class="p">};</span>
		<span class="n">dcdc3_reg</span><span class="o">:</span> <span class="n">regulator</span><span class="err">@</span><span class="mi">2</span> <span class="p">{</span>
			<span class="n">regulator</span><span class="o">-</span><span class="n">name</span> <span class="o">=</span> <span class="s">"vdd_core"</span><span class="p">;</span>
			<span class="n">regulator</span><span class="o">-</span><span class="n">min</span><span class="o">-</span><span class="n">microvolt</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">925000</span><span class="o">&gt;</span><span class="p">;</span>
			<span class="n">regulator</span><span class="o">-</span><span class="n">max</span><span class="o">-</span><span class="n">microvolt</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">1150000</span><span class="o">&gt;</span><span class="p">;</span>
			<span class="n">regulator</span><span class="o">-</span><span class="n">boot</span><span class="o">-</span><span class="n">on</span><span class="p">;</span>
			<span class="n">regulator</span><span class="o">-</span><span class="n">always</span><span class="o">-</span><span class="n">on</span><span class="p">;</span>
		<span class="p">};</span>
		<span class="n">ldo1_reg</span><span class="o">:</span> <span class="n">regulator</span><span class="err">@</span><span class="mi">3</span> <span class="p">{</span>
			<span class="n">regulator</span><span class="o">-</span><span class="n">always</span><span class="o">-</span><span class="n">on</span><span class="p">;</span>
		<span class="p">};</span>

	<span class="p">};</span>
<span class="p">};</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></figure>
</p>
<p>
In the above example, you'll start to see the use of Device Tree Source Include files (.dtsi),
which allow us to include subnode definitions by model name, for building heirarchically.
You'll also notice the defintion of the "dcdc2_reg" label here, which was used in our first
example to define the power supply for the cpu. A few of the parameters worth mentioning:
<ul>
<li>regulator-min-microvolt: how we define the min/max range of the power supplies</li>
<li>regulator-boot-on: this regulator is on during booting</li>
<li>regulator-always-on: this regulator is expected to be always powered up</li>
</ul>
<p>
<h2>Installing the Device Tree Compiler</h2>
On a typical Linux system distribution, you can install the Device Tree compiler using :

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">device</span><span class="o">-</span><span class="n">tree</span><span class="o">-</span><span class="n">compiler</span></code></pre></figure>

Then check your installation, by asking for the DTC version :
<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">moxon</span><span class="err">@</span><span class="n">fs</span><span class="o">:~</span><span class="err">$</span> <span class="n">dtc</span> <span class="o">-</span><span class="n">v</span>
<span class="n">Version</span><span class="o">:</span> <span class="n">DTC</span> <span class="mi">1</span><span class="p">.</span><span class="mi">3</span><span class="p">.</span><span class="mi">0</span>
<span class="n">moxon</span><span class="err">@</span><span class="n">fs</span><span class="o">:~</span><span class="err">$</span></code></pre></figure>

If you are looking for a specific how-to guide for BeagleBone, Raspberry Pi, Xixlinx, Altera, etc,
please see the References section at the end of this article for a complete listing. A number of people
in the community have already written some excellent guides for specific platforms. 
</p>
<p>
<h2>Using the Device Tree Compiler</h2>
The Device Tree Compiler is a simple command line tool that is used to read 
<a href="http://www.devicetree.org/">Device Tree Source (.dts)</a> files, and 
generate a Flattened Device Tree Binary Object file (.dtb), also known as the
"Device Tree BLOB".

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">moxon</span><span class="err">@</span><span class="n">fs</span><span class="o">:~</span><span class="err">$</span> <span class="n">dtc</span> <span class="o">-</span><span class="n">O</span> <span class="n">dtb</span> <span class="o">-</span><span class="n">o</span> <span class="n">outputBLOB</span><span class="p">.</span><span class="n">dtb</span> <span class="o">-</span><span class="n">b</span> <span class="mi">0</span> <span class="n">inputSOURCE</span><span class="p">.</span><span class="n">dts</span></code></pre></figure>
Pretty simple really, the Device Tree Compiler reads the input file named "inputSOURCE.dts",
and generates the output file named "outputBLOB.dtb". The output file can then be loaded into
flash or EEPROM for use during the boot up sequence.
</p>
<p>
<p>
<h2>Flattened Device Tree Binary Objects (.dtb)</h2>
So what does the output of the Device Tree Compiler look like?
If you want the gory details(including the address alignment requirements), they are described in 
<a href="https://www.power.org/wp-content/uploads/2012/06/Power_ePAPR_APPROVED_v1.1.pdf">Chapter 8 of the ePAPR specification</a>,
but here's a quick overview : 
</p>
<p>
<img src="/img/news/devicetree/device-tree-fdt.png" alt="Flattened Device Tree" title="Flattened Device Tree"/>
</p>
<p>
And the Flattened Device Tree Binary Header Structure (fdt_header) looks like this :
</p>
<p>
<img src="/img/news/devicetree/device-tree-fdt-header.png" alt="Flattened Device Tree Header" title="Flattened Device Tree Header"/>
</p>
<p>
After the Flattened Device Tree Binary Header Structure, comes the memory reservation block, the structure block, and the strings block, respectively.
So the Flattened Device Tree Binary format is not that complicated to understand, and the main "action" occurs by parsing the "structure" block,
which holds the node relationships (i.e. the graph of the tree). The structure block is a list of nodes, separated by the following <i>tokens</i>
to give the tree it's structure :
<ul>
<li>0x00000001 : FDT_BEGIN_NODE : Starts a node description, with node name and address as strings</li>
<li>0x00000002 : FDT_END_NODE &nbsp; &nbsp; : Ends a node description</li>
<li>0x00000003 : FDT_PROP &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : Starts a node property, followed by a node property structure</li>
<li>0x00000003 : FDT_NOP &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : No Operation, used as a placeholder and alignment filler</li>
<li>0x00000003 : FDT_END &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : Ends the structure block, only one per Device Tree.</li>
</ul>
At the end of the Flattened Device Tree Binary Object is the "Strings Block", containing all the property name strings used in the tree
concatenated together. The "Structure Block" refers to the strings within the "String Block" using an offset from the start address of
the "Strings Block". If you want to take a look at a FDT parser,  then check out the
<a href="https://packages.debian.org/wheezy/libfdt-dev">libfdt library</a> for handling FDT (BLOB) objects.
</p>
<p>
In the next article, I'll cover Device Tree Overlays, the new mechanism for describing the hardware
of add-on boards like BeagleBone "Capes", or Raspberry Pi "Plates".
</p>
<p>   
<h2>References, Footnotes, and more Device Tree information...</h2>
<ol>
<li><a href="http://events.linuxfoundation.org/sites/events/files/slides/petazzoni-device-tree-dummies.pdf">Device Tree for Dummies - Thomas Petroni</a></li>
<li><a href="https://learn.adafruit.com/introduction-to-the-beaglebone-black-device-tree">BeagleBlack Device Tree Tutorial - Adafruit</a></li>
<li><a href="http://xillybus.com/tutorials/device-tree-zynq-1">Xilinx Device Tree Tutorial - Xillybus</a></li>
<li><a href="http://xillybus.com/tutorials/device-tree-altera-soc-cyclone">Altera Device Tree Tutorial - Xillybus</a></li>
<li><a href="https://blueprints.launchpad.net/ubuntu/+spec/mobile-lucid-arm-device-tree-support">ARM Device Tree Support - Ubuntu</a></li>
<li><a href="http://www.alterawiki.com/wiki/Sopc2dts">Altera Device Tree Support - Altera</a></li>
<li><a href="https://www.kernel.org/doc/Documentation/devicetree/bindings/">Index of Device Tree Bindings - kernal.org</a></li>
<li><a href="http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/plain/Documentation/devicetree/bindings/graph.txt">Device Tree Graphing - kernal.org</a></li>
<li><a href="https://packages.debian.org/wheezy/libfdt-dev">libfdt - manipulating FDT Blobs - David Gibson</a></li>
<li><a href="http://www.informit.com/articles/article.aspx?p=1647051&seqNum=5">Linux Bootloaders - informit.com</a></li>
<li><a href="http://haifux.org/lectures/288/haifux-devicetree.pdf">Device Tree PnP - Eli Billauer</a></li>
<li><a href="https://lkml.org/lkml/2013/1/7/366">Device Tree Overlay Manager - Pantelis Antoniou</a></li>
<li><a href="https://lkml.org/lkml/2012/11/5/615">Device Tree Overlay Proposal - Grant Likely</a></li>
<li><a href="https://github.com/cdsteinkuehler/beaglebone-universal-io">BeagleBlack Univeral I/O - cdsteinkuehler</a></li>
<li><a href="http://kilobaser.com/blog/2014-07-28-beaglebone-black-devicetreeoverlay-generator#dtogenerator">BeagleBlack Device Tree Overlay Generator - Kilobaser</a></li>
<li><a href="http://derekmolloy.ie/gpios-on-the-beaglebone-black-using-device-tree-overlays/">GPIOs on the Beaglebone Black using the Device Tree Overlays- derek molloy</a></li>
<li><a href="http://elinux.org/images/f/f2/Supporting_200_Different_Expansionboards_The_Broken_Promise_of_Devicetree.pdf">Supporting 200 Different Expansion Boards -  elinux.org</a></li>
<li><a href="http://events.linuxfoundation.org/sites/events/files/slides/presentation_3.pdf">DT, The Disaster so Far - Mark Rutland</a></li>
<li><a href="http://elinux.org/images/5/5c/ELCE2013_-_DT_War.pdf">Board File to Device Tree Migration - Pantelis Antoniou</a></li>
</ol>
</p>

</div>
    <footer>
      <p class="meta">
        January 28, 2015
      </p>
      <p class="meta">
        
          <a class="previous" href="/news/2015/01/27/sensor-abilities.html" title="Previous Post: Sense and Sensor Abilities">&laquo; Sense and Sensor Abilities</a>
        
        
          <a class="next" href="/news/2015/01/29/devicetree-overlays.html" title="Next Post: Device Tree Overlays">Device Tree Overlays &raquo;</a>
        
      </p>
    </footer>
  </article>


  </div>
  <div class="col minor">
    
  <h2>Featured Projects</h2>
  <ul class="post-list">
  
    
      
    
      
        <li>
          <a href="/projects/AB_ESP8266.html">Agent Bees - ESP8266</a>
        </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <li>
          <a href="/projects/TouchWidget_HowTo.html">TouchWidgets How-To Example Project</a>
        </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <li>
          <a href="/projects/Hula_Poppy.html">Hula Poppy - Pmod Lure for the Intel MinnowBoard</a>
        </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
</ul>
  <h2>Latest News</h2>
  <ul class="post-list">
  
    <li>
      <a href="/news/2015/08/25/IoT-RTLS.html">Real-Time Location Systems for IoT</a>
    </li>
  
    <li>
      <a href="/news/2015/06/19/IoT-SoCs.html">New IoT SoCs</a>
    </li>
  
    <li>
      <a href="/news/2015/06/05/devicetree-more-flavors.html">More DeviceTree Flavors!</a>
    </li>
  
    <li>
      <a href="/news/2015/05/21/devicetree-smart-objects.html">Smart Device Trees meet Smart Objects</a>
    </li>
  
    <li>
      <a href="/news/2015/02/09/devicetree-discussions.html">Device Tree Discussions</a>
    </li>
  
    <li>
      <a href="/news/2015/02/06/smart-devicetrees.html">Smart Devicetrees</a>
    </li>
  
    <li>
      <a href="/news/2015/02/02/devicetree-on-modbus.html">Device Tree on Modbus</a>
    </li>
  
    <li>
      <a href="/news/2015/02/01/devicetree-lifecycle.html">Device Tree and Product Life Cycles</a>
    </li>
  
    <li>
      <a href="/news/2015/01/29/devicetree-overlays.html">Device Tree Overlays</a>
    </li>
  
    <li>
      <a href="/news/2015/01/28/devicetree-overview.html">Device Tree Overview</a>
    </li>
  
    <li>
      <a href="/news/2015/01/27/sensor-abilities.html">Sense and Sensor Abilities</a>
    </li>
  
    <li>
      <a href="/news/2015/01/25/the-blob.html">The BLOB - Binary Level OBjects</a>
    </li>
  
    <li>
      <a href="/news/2015/01/23/the-great-chain.html">Automatic Configuration Chains</a>
    </li>
  
    <li>
      <a href="/news/2015/01/22/SFF-SelfConfig.html">Small Form Factor Auto-Configuration</a>
    </li>
  
    <li>
      <a href="/news/2013/12/26/Hula-Poppy-Lure-minnow-board.html">Hula Poppy Lure for MinnowBoard</a>
    </li>
  
    <li>
      <a href="/news/2013/12/24/minnow-board-lures.html">MinnowBoard Lures Library</a>
    </li>
  
    <li>
      <a href="/news/2013/12/02/touchwidget-best-practices.html">Touch Widgets - Best Practices</a>
    </li>
  
    <li>
      <a href="/news/2013/11/29/touch-widgets-howto.html">Touch Widgets How-To/Instructions</a>
    </li>
  
    <li>
      <a href="/news/2013/11/24/eagle-touch-widgets-library.html">Touch Widgets Library for Eagle</a>
    </li>
  
    <li>
      <a href="/news/2013/11/20/capacitive-sensing-introduction.html">Capacitance Sensing Introduction</a>
    </li>
  
    <li>
      <a href="/news/2013/11/14/building-your-new-widget.html">Building Your New Widget</a>
    </li>
  
    <li>
      <a href="/news/2013/11/11/eaglecad-libraries.html">EagleCAD Libraries</a>
    </li>
  
    <li>
      <a href="/news/2013/11/09/quattrocycle-update.html">Quattrocycle Lighting Update</a>
    </li>
  
    <li>
      <a href="/news/2013/09/13/portland-maker-faire.html">Portland Mini-Maker Faire</a>
    </li>
  
    <li>
      <a href="/news/2013/07/09/arduino-yun-the-next-generation.html">Arduino Y'un - The Next Generation</a>
    </li>
  
</ul>


  </div>

</main>
   

<form id="signup"
      action="http://patternagents.us5.list-manage.com/subscribe/post?u=d606135278a28bf2e4504c9ef&id=34ecdcaa40"
      method="post"
      id="mc-embedded-subscribe-form"
      name="mc-embedded-subscribe-form"
      class="validate"
      target="_blank"
      novalidate>
  <div class="row"><div class="col">
    
  <div class="row collapse">
      <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
      <button class="postfix" type="submit">Subscribe</button>
  </div>
  </div></div>
</form>
   <!-- Add the discussion widget -->
   

<!-- discus panel -->
<!-- place "comments: true" in the YAML front matter to enable comments in that page -->

<div class="panel" id="disqus_thread"></div>

   

<footer>
  <div class="row">
    <div class="col half">
      <div class="row">
        <div class="col quarter">
          <ul class="social-icons">
           <li><a href="https://twitter.com/PatternAgents" title="twitter"><img src="/img/logos/white/twitter.png"></a></li>
            <li><a href="https://github.com/PatternAgents" title="github"><img src="/img/logos/white/github.png"></a></li>
            <li><a href="http://www.linkedin.com/company/3092259" title="linkedin"><img src="/img/logos/white/linkedin.png"></a></li>
            <li><a href="https://www.facebook.com/pages/PatternAgents/" title="facebook"><img src="/img/logos/white/facebook.png"></a></li>
            <li><a href="http://pinterest.com/patternagents" title="pinterest"><img src="/img/logos/white/pinterest.png"></a></li>
          </ul>
        </div>
        <div class="col quarter">
            <h2><a href="/contact/index.html">Contact</a></h2>
            <ul>
              <li><a href="/contact/press.html">Press</a></li>
              <li><a href="/contact/investors.html">Investors</a></li>
              <li><a href="/licensing/index.html">Licensing</a></li>
              <li><a href="/contact/credits.html">Credits</a></li>
            </ul>
        </div>
      </div>
    </div>
    <div class="col half">
      <div class="row">
        <div class="col quarter">
          <h2><a href="/about/index.html">About Us</a></h2>
          <ul>
            <li><a href="/about/manufacturers.html">For Manufacturers</a></li>
            <li><a href="/about/distributors.html">For Distributors</a></li>
            <li><a href="/about/representatives.html">For Representatives</a></li>
          </ul>
        </div>
        <div class="col quarter">
          <h2><a href="/policies/index.html">Policies</a></h2>
          <ul>
            <li><a href="/policies/shipping.html">Shipping</a></li>
            <li><a href="/policies/returns.html">Returns</a></li>
            <li><a href="/policies/legal/index.html">Legal</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="row unimportant">
    <div class="col quarter"><p>Copyright &copy; 2010-2015 PatternAgents</p></div>
  </div>
</footer>

<script src="/js/lib/jquery.js"></script>


<!-- disqus widget script -->
<script type="text/javascript">
  var disqus_shortname = 'patternagents';
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- pinterest widget script -->
<script type="text/javascript">
(function(d){
  var f = d.getElementsByTagName('SCRIPT')[0], p = d.createElement('SCRIPT');
  p.type = 'text/javascript';
  p.async = true;
  p.setAttribute('data-pin-color', 'red');
  p.setAttribute('data-pin-hover', 'true');
  p.src = '//assets.pinterest.com/js/pinit.js';
  f.parentNode.insertBefore(p, f);
}(document));
</script>
<!-- toggle menu -->
<script>
  $(function() {
    var $navToggle = $('nav.toggle');
    $navToggle.addClass('collapsed');
    $navToggle.find('h2').bind('click focus', function() {
      // if we want to get fancy, we can animate the max-height here
      $navToggle.toggleClass('collapsed');
    });
  });
</script>




  






</body>
</html>
