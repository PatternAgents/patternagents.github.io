
<!DOCTYPE html>
<!--[if IE 8]>         <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <title>PatternAgents: Smart Device Trees</title>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />

  <meta name="robots"          content="index, follow, noodp, noydir" />
  <meta name="description"     content="PatternAgents: The Agency of Design Patterns" />
  <meta name="abstract"        content="PatternAgents provides collaboration, community and commerce for electronics designers." />
  <meta name="classification"  content="electronics, electronics design, design engineering" />
  <meta name="keywords"        content="electronics, electronics design, design engineering, open source software, open source hardware, OSHW" />

  <link rel="apple-touch-icon" type="image/png" href="/img/logos/apple-touch-icon-144x144.png" />
  <!--  <link rel="icon" type="image/png" href="http://www/patternagents.com/img/logos/apple-touch-icon.png"/>  -->

  <!-- Ubuntu for logo -->
  <link href='http://fonts.googleapis.com/css?family=Ubuntu:400,700' rel='stylesheet' type='text/css'>

<!--[if lte IE 8]>
    <link rel="stylesheet" href="/css/app-old-ie.css">
<![endif]-->
<!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="/css/app.css">
<!--<![endif]-->
  
<!-- Begin MailChimp Signup Form -->
 <link href="//cdn-images.mailchimp.com/embedcode/classic-081711.css" rel="stylesheet" type="text/css">
 <style type="text/css">
	#mc_embed_signup{position:absolute; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,.8); display:block; z-index:10000; }
	#mc_embed_signup form{position:fixed; top:5%; left:5%; right:5%; bottom:5%; width:60%; font:normal 100% Helvetica,Arial,sans-serif; font-size:14px; border-radius:4px; border:3px; padding:10px; background-color:#eee; color:#000; text-align:left;max-height:800px;overflow-y:auto;overflow-x:hidden;}
	#mc_embed_signup a.mc_embed_close{background:transparent url(http://downloads.mailchimp.com/img/closebox.png) no-repeat; display:block; height:30px; width:30px; text-indent:-999em; position:absolute; top:10px; right:10px; display:none; }
 </style>

<!-- Begin Google Analytics -->
 <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38592761-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  </script>

</head>

<body class="">
 




















<header>
  <div class="head-container">
	  <div class="col">
	    <a href="/">
	      <h1>Pattern&#8203;<b>Agents</b> <span class="tag-line">Connecting the electronics design community</span></h1>
	    </a>
	  </div>
  </div>
</header>



<div class="row"><div class="col">
<nav class="toggle">
  <h2><a href="#" title="(click to expand)"><span class="menu-icon">&#9776;</span> Go to:</a></h2>
  <ul>
    <li class="nav-store"><a href="/store/index.html">Store</a></li>
    <li class="nav-projects"><a href="/projects/index.html">Projects</a></li>
    <li class="nav-support"><a href="/support/index.html">Support</a></li>
    <li class="nav-about"><a href="/about/index.html">About</a></li>
    <li class="nav-news"><a href="/news/index.html">News</a></li>
  </ul>
</nav>
</div></div>


  

<main class="row">
  
  <div class="col major">
    
  
  <article role="article">
    <header>
      
        <h1 class="entry-title">Smart Device Trees</h1>
      
      
        <p class="meta">
          
        </p>
      
    </header>
    <div class="entry-content">
  
  
  

<blockquote>
	<p>A smart man makes a mistake, learns from it, and never makes that mistake again. But a wise man finds a smart man and learns from him how to avoid the mistake altogether.</p>
	<p>&mdash;Roy H. Williams</p>
</blockquote>

<p>
Lately, I've been working on automatic discovery and configuration of devices and peripherals, using 
<a href="http://www.patternagents.com/news/2015/01/25/the-blob.html">Binary Level Objects</a>, like the
<a href="http://www.intel.com/content/www/us/en/servers/ipmi/information-storage-definition-rev-1-2.html">IPMI FRU</a>, the
<a href="http://www.devicetree.org/Device_Tree_Usage">Device Tree</a> and
<a href="http://www.devicetree.org/Device_Tree_Usage">Device Tree Overlay</a> formats.
Typically these have been implemented using just a "dumb" storage device,
like an <a href="http://en.wikipedia.org/wiki/EEPROM">EEPROM</a>, or an 
<a href="http://en.wikipedia.org/wiki/Secure_Digital">SDcard</a>, or perhaps a 
<a href="http://www.st.com/web/en/catalog/mmc/FM76/CL1766/SC1412/SS1812">Dynamic NFC/RFID tag</a>.
So, what then, do I mean by a "Smart" Device Tree?
<br><br>
</p>
<!-- more -->
<p>
<h2>Low Cost Microcontrollers</h2>
A few years ago, we were all abuzz about the "$1" ARM Cortex devices like the Cortex M-3, 
and later, the Cortex M-0 devices.
Hat's off to <a href="http://www.arm.com/">ARM Ltd.</a> for making 32-bit microcontrollers ubiquitous.
By now (2015), the cost of simple microcontrollers are more about the amount of flash memory
and the features included, than the microcontroller itself. These days I can usually find a 
low feature, low pin count, microcontroller for little more than the cost of a "dumb" storage device.
Additionally, the smartphone and mobile handset market has lead the push to smaller packages, 
and lower power microcontrollers, in order to increase the battery powered run time. So the 
threshold for adding "intelligence" (i.e. a microcontroller) to solving hardware design problems
has gotten very low indeed.
</p>
<p>
<h2>Common Data Structures</h2>
Regardless of what kind of microcontroller and development environment you choose for your products,
you'll soon realize that you need to keep track of lot of <a href="http://en.wikipedia.org/wiki/Metadata"><i>metadata</i></a> 
which most development enviroments will leave up to you, the user. I'm talking about the kinds of data you need regardless of
what kind of product you are building, and what kind of firmware/software you are using. 
How do you keep track of things
like Serial Numbers, Version Numbers, MAC ID's, Interface Addresses, etc. in a uniform way?
Where do you keep them in your firmware (program)and how do you keep them current
without having to change the firmware itself?
From a complex Drone design to a more simple toaster oven, wouldn't it be good
if we could handle all that <a href="http://en.wikipedia.org/wiki/Metadata">metadata</a>
in a more simple way?     
</p>
<h2>Common Interfaces</h2>
<img class="illo" src="/img/news/devicetree/smart-dev-tree.png" alt="Example Low Cost Microcontroller" title="Example Low Cost Microcontroller"/>
Most of the low cost microcontrollers today have a good mix of common interfaces, like 
<a href="http://en.wikipedia.org/wiki/I%C2%B2C">I2C</a>, 
<a href="http://en.wikipedia.org/wiki/Serial_Peripheral_Interface_Bus">SPI</a>, and 
<a href="http://en.wikipedia.org/wiki/Universal_asynchronous_receiver/transmitter">UARTs</a>.
And most vendors also include some simple emulation functions, that allow you to reserve an
area of the microcontroller's flash memory to emulate a "dumb" storage device using those
interfaces. In other words, if you use an I2C EEPROM emulation function on most microcontrollers,
then to the outside world connecting to your microprocessor, your microcontroller looks exactly 
like a "dumb" I2C EEPROM. The same concept applies if you bind one of your SPI Slave controllers 
to a SPI EEPROM emulator function, then to the outside world, your microcontroller would 
look just like a "dumb" SPI EEPROM.  
</p>
<p>
<h2>Device Tree Flash Mapping</h2>
Of course, "under the hood", this solution is not "dumb" at all. 
When you utilize an I2C or SPI EEPROM emulation function, 
you generally pass a pointer to the flash memory area that you want reserved 
for the EEPROM memory emulation. If we are not going to do much else with 
microcontroller we might even reserve the majority of the microcontrollers flash memory.
Now, imagine for a moment that reserved flash memory area is used to hold the 
Flattened Device Tree "BLOB" of binary data, perhaps for an expansion board.
What we have now, is a "Smart Device Tree". We can even access that
Device Tree from two different interfaces, namely 
<a href="http://en.wikipedia.org/wiki/I%C2%B2C">I2C</a>, and 
<a href="http://en.wikipedia.org/wiki/Serial_Peripheral_Interface_Bus">SPI</a>
at the same time. In my 
<a href=http://localhost:4000/news/2015/02/02/devicetree-on-modbus.html">last article</a>
I demonstrated how to map the Device Tree onto a <a href="http://en.wikipedia.org/wiki/Modbus">Modbus</a> 
RTU using a UART interface. I've successfully employed these techniques in several customer designs.
</p>
<p>
<h2>Adding Some Intelligence</h2>
You'll notice that I put an "Internal Temperature" block in the above microcontroller block
diagram, as most microcontrollers have a junction temperature measurement that can be used
to read the internal temperature of the device. Now, imagine for a moment, that the microcontroller
takes a temperature measurement every second of so, and maintains a running average temperature.
So, what happens if we store that as a property into the Flattened <a href="http://www.devicetree.org/">Device Tree</a> (BLOB)?
Well, now we have a <a href="http://www.devicetree.org/">Dynamic Device Tree</a>.
</p>
<p>
<h2>Summary</h2>
Adding the Device Tree data structure to an embedded micrcontroller design is 
pretty straightforward and simple, and enables the automatic discovery and configuration of 
a variety of devices and peripherals; and this is just the beginning... 
</p>
<p>   
<h2>References, Footnotes, and more...</h2>
<ol>
<li><a href="http://www.modbus.org/specs.php">Modbus Specifications</a></li>
<li><a href="http://events.linuxfoundation.org/sites/events/files/slides/petazzoni-device-tree-dummies.pdf">Device Tree for Dummies - Thomas Petroni</a></li>
<li><a href="https://learn.adafruit.com/introduction-to-the-beaglebone-black-device-tree">BeagleBlack Device Tree Tutorial - Adafruit</a></li>
<li><a href="http://xillybus.com/tutorials/device-tree-zynq-1">Xilinx Device Tree Tutorial - Xillybus</a></li>
<li><a href="http://xillybus.com/tutorials/device-tree-altera-soc-cyclone">Altera Device Tree Tutorial - Xillybus</a></li>
<li><a href="https://blueprints.launchpad.net/ubuntu/+spec/mobile-lucid-arm-device-tree-support">ARM Device Tree Support - Ubuntu</a></li>
<li><a href="http://www.alterawiki.com/wiki/Sopc2dts">Altera Device Tree Support - Altera</a></li>
<li><a href="https://www.kernel.org/doc/Documentation/devicetree/bindings/">Index of Device Tree Bindings - kernal.org</a></li>
<li><a href="http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/plain/Documentation/devicetree/bindings/graph.txt">Device Tree Graphing - kernal.org</a></li>
<li><a href="https://packages.debian.org/wheezy/libfdt-dev">libfdt - manipulating FDT Blobs - David Gibson</a></li>
<li><a href="http://www.informit.com/articles/article.aspx?p=1647051&seqNum=5">Linux Bootloaders - informit.com</a></li>
<li><a href="http://haifux.org/lectures/288/haifux-devicetree.pdf">Device Tree PnP - Eli Billauer</a></li>
<li><a href="https://lkml.org/lkml/2013/1/7/366">Device Tree Overlay Manager - Pantelis Antoniou</a></li>
<li><a href="https://lkml.org/lkml/2012/11/5/615">Device Tree Overlay Proposal - Grant Likely</a></li>
<li><a href="https://github.com/cdsteinkuehler/beaglebone-universal-io">BeagleBlack Univeral I/O - cdsteinkuehler</a></li>
<li><a href="http://kilobaser.com/blog/2014-07-28-beaglebone-black-devicetreeoverlay-generator#dtogenerator">BeagleBlack Device Tree Overlay Generator - Kilobaser</a></li>
<li><a href="http://derekmolloy.ie/gpios-on-the-beaglebone-black-using-device-tree-overlays/">GPIOs on the Beaglebone Black using the Device Tree Overlays- derek molloy</a></li>
<li><a href="http://elinux.org/images/f/f2/Supporting_200_Different_Expansionboards_The_Broken_Promise_of_Devicetree.pdf">Supporting 200 Different Expansion Boards -  elinux.org</a></li>
<li><a href="http://events.linuxfoundation.org/sites/events/files/slides/presentation_3.pdf">DT, The Disaster so Far - Mark Rutland</a></li>
<li><a href="http://elinux.org/images/5/5c/ELCE2013_-_DT_War.pdf">Board File to Device Tree Migration - Pantelis Antoniou</a></li>
<li><a href="http://lwn.net/Articles/616859/">Device Tree Overlays - Jonathon Corbet</a></li>
</ol>
</p>



</div>
    <footer>
      <p class="meta">
        February 06, 2015
      </p>
      <p class="meta">
        
          <a class="previous" href="/news/2015/02/02/devicetree-on-modbus.html" title="Previous Post: Device Tree on Modbus">&laquo; Device Tree on Modbus</a>
        
        
      </p>
    </footer>
  </article>


  </div>
  <div class="col minor">
    
  <h2>Featured Projects</h2>
  <ul class="post-list">
  
    
      
    
      
    
      
    
      
        <li>
          <a href="/projects/Hula_Poppy.html">Hula Poppy - Pmod Lure for the Intel MinnowBoard</a>
        </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
      
    
      
    
      
    
      
    
      
        <li>
          <a href="/projects/TouchWidget_HowTo.html">TouchWidgets How-To Example Project</a>
        </li>
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <li>
          <a href="/projects/Caldi.html">Caldi - I2C PyroInfraRed Grid Array Sensor</a>
        </li>
      
    
  
</ul>
  <h2>Latest News</h2>
  <ul class="post-list">
  
    <li>
      <a href="/news/2015/02/06/smart-devicetrees.html">Smart Device Trees</a>
    </li>
  
    <li>
      <a href="/news/2015/02/02/devicetree-on-modbus.html">Device Tree on Modbus</a>
    </li>
  
    <li>
      <a href="/news/2015/02/01/devicetree-lifecycle.html">Device Tree and Product Life Cycles</a>
    </li>
  
    <li>
      <a href="/news/2015/01/29/devicetree-overlays.html">Device Tree Overlays</a>
    </li>
  
    <li>
      <a href="/news/2015/01/28/devicetree-overview.html">Device Tree Overview</a>
    </li>
  
    <li>
      <a href="/news/2015/01/27/sensor-abilities.html">Sense and Sensor Abilities</a>
    </li>
  
    <li>
      <a href="/news/2015/01/25/the-blob.html">The BLOB - Binary Level OBjects</a>
    </li>
  
    <li>
      <a href="/news/2015/01/23/the-great-chain.html">Automatic Configuration Chains</a>
    </li>
  
    <li>
      <a href="/news/2015/01/22/SFF-SelfConfig.html">Small Form Factor Auto-Configuration</a>
    </li>
  
    <li>
      <a href="/news/2013/12/26/Hula-Poppy-Lure-minnow-board.html">Hula Poppy Lure for MinnowBoard</a>
    </li>
  
    <li>
      <a href="/news/2013/12/24/minnow-board-lures.html">MinnowBoard Lures Library</a>
    </li>
  
    <li>
      <a href="/news/2013/12/02/touchwidget-best-practices.html">Touch Widgets - Best Practices</a>
    </li>
  
    <li>
      <a href="/news/2013/11/29/touch-widgets-howto.html">Touch Widgets How-To/Instructions</a>
    </li>
  
    <li>
      <a href="/news/2013/11/24/eagle-touch-widgets-library.html">Touch Widgets Library for Eagle</a>
    </li>
  
    <li>
      <a href="/news/2013/11/20/capacitive-sensing-introduction.html">Capacitance Sensing Introduction</a>
    </li>
  
    <li>
      <a href="/news/2013/11/14/building-your-new-widget.html">Building Your New Widget</a>
    </li>
  
    <li>
      <a href="/news/2013/11/11/eaglecad-libraries.html">EagleCAD Libraries</a>
    </li>
  
    <li>
      <a href="/news/2013/11/09/quattrocycle-update.html">Quattrocycle Lighting Update</a>
    </li>
  
    <li>
      <a href="/news/2013/09/13/portland-maker-faire.html">Portland Mini-Maker Faire</a>
    </li>
  
</ul>


  </div>

</main>
   

<form id="signup"
      action="http://patternagents.us5.list-manage.com/subscribe/post?u=d606135278a28bf2e4504c9ef&id=34ecdcaa40"
      method="post"
      id="mc-embedded-subscribe-form"
      name="mc-embedded-subscribe-form"
      class="validate"
      target="_blank"
      novalidate>
  <div class="row"><div class="col">
    
  <div class="row collapse">
      <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
      <button class="postfix" type="submit">Subscribe</button>
  </div>
  </div></div>
</form>
   <!-- Add the discussion widget -->
   

<!-- discus panel -->
<!-- place "comments: true" in the YAML front matter to enable comments in that page -->

<div class="panel" id="disqus_thread"></div>

   

<footer>
  <div class="row">
    <div class="col half">
      <div class="row">
        <div class="col quarter">
          <ul class="social-icons">
           <li><a href="https://twitter.com/PatternAgents" title="twitter"><img src="/img/logos/white/twitter.png"></a></li>
            <li><a href="https://github.com/PatternAgents" title="github"><img src="/img/logos/white/github.png"></a></li>
            <li><a href="http://www.linkedin.com/company/3092259" title="linkedin"><img src="/img/logos/white/linkedin.png"></a></li>
            <li><a href="https://www.facebook.com/pages/PatternAgents/" title="facebook"><img src="/img/logos/white/facebook.png"></a></li>
            <li><a href="http://pinterest.com/patternagents" title="pinterest"><img src="/img/logos/white/pinterest.png"></a></li>
          </ul>
        </div>
        <div class="col quarter">
            <h2><a href="/contact/index.html">Contact</a></h2>
            <ul>
              <li><a href="/contact/press.html">Press</a></li>
              <li><a href="/contact/investors.html">Investors</a></li>
              <li><a href="/licensing/index.html">Licensing</a></li>
              <li><a href="/contact/credits.html">Credits</a></li>
            </ul>
        </div>
      </div>
    </div>
    <div class="col half">
      <div class="row">
        <div class="col quarter">
          <h2><a href="/about/index.html">About Us</a></h2>
          <ul>
            <li><a href="/about/manufacturers.html">For Manufacturers</a></li>
            <li><a href="/about/distributors.html">For Distributors</a></li>
            <li><a href="/about/representatives.html">For Representatives</a></li>
          </ul>
        </div>
        <div class="col quarter">
          <h2><a href="/policies/index.html">Policies</a></h2>
          <ul>
            <li><a href="/policies/shipping.html">Shipping</a></li>
            <li><a href="/policies/returns.html">Returns</a></li>
            <li><a href="/policies/legal/index.html">Legal</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="row unimportant">
    <div class="col quarter"><p>Copyright &copy; 2010-2015 PatternAgents</p></div>
  </div>
</footer>

<script src="/js/lib/jquery.js"></script>


<!-- disqus widget script -->
<script type="text/javascript">
  var disqus_shortname = 'patternagents';
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<!-- pinterest widget script -->
<script type="text/javascript">
(function(d){
  var f = d.getElementsByTagName('SCRIPT')[0], p = d.createElement('SCRIPT');
  p.type = 'text/javascript';
  p.async = true;
  p.setAttribute('data-pin-color', 'red');
  p.setAttribute('data-pin-hover', 'true');
  p.src = '//assets.pinterest.com/js/pinit.js';
  f.parentNode.insertBefore(p, f);
}(document));
</script>
<!-- toggle menu -->
<script>
  $(function() {
    var $navToggle = $('nav.toggle');
    $navToggle.addClass('collapsed');
    $navToggle.find('h2').bind('click focus', function() {
      // if we want to get fancy, we can animate the max-height here
      $navToggle.toggleClass('collapsed');
    });
  });
</script>




  






</body>
</html>
