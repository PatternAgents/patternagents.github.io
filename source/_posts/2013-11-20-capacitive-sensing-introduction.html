---
layout: post
category: news
title: "Capacitance Sensing Introduction"
date: 2013-11-20 13:49
quote: When we are touched by something it's as if we're being brushed by an angel's wings.
quote_author: Rita Dove
product_slug: CapSense
licensing: true
cc_by_sa: true
meta:
  robots: "noodp, noydir, noarchive"
  description: "Capacitance Sensing Introduction"
  abstract: "Capacitance Sensing Introduction - methods and tools for adding capacitive sensing to your projects"
  keywords: "capacitance, capacitive sensing, capsense, touch, captouch, mtouch, qtouch, eagle, cad, eaglecad, eagle cad, libraries, open source, make, maker, maker space, arduino, uno, mega, due, yun, schematic, layout, pcb, pcb design"
comments: true
---
<p>Capacitive Sensing is ubiquitous now, from your smartphone screen, 
or your Apple iPod, to the "buttons" on your new TV remote control.
Today we'll be talking about how capacitive sensing works and how you can use it on your next project.</p>
<!-- more -->
<p><a href="http://en.wikipedia.org/wiki/Capacitive_sensing">Capacitive Sensing</a> is a technology that uses the human body capacitance as a sensor input to a control interface.
If you have used almost any recent smartphone touch screen or a non-mechanical button, 
then you have likely used a capacitive sensor of some kind.
There are many different applications for capacitive sensors, such as distance or proximity measurement, 
material thickness measurement, fluid level measurement, gyroscopic position, and acceleration measurement. 
Often the trackpad on your laptop is implemented an X/Y capacitance measurement device.
</p>
<p>
A <a href="http://en.wikipedia.org/wiki/Capacitor">Capacitor</a> is formed whenever two conductive surfaces are separated by an insulating layer, 
which is known as the <a href="http://en.wikipedia.org/wiki/Dielectric">dielectric</a> layer.
Capacitance is measured in  <a href="http://en.wikipedia.org/wiki/Farads">Farads</a>.
There are many different <a href="http://en.wikipedia.org/wiki/Capacitive_sensing">capacitive sensing</a> algorithms, 
and the sensors themselves can be constructed from many different materials, such as aluminum, silver, gold, copper, 
<a href="http://en.wikipedia.org/wiki/Indium_tin_oxide">Indium Tin Oxide (ITO)</a>, and various printed (conductive) inks. 
Typically copper capacitive sensors can be implemented using standard FR4 (fiberglass) 
printed circuit board material itself as the dielectric layer. 
Touch screen capacitive sensors typically utilize <a href="http://en.wikipedia.org/wiki/Indium_tin_oxide">Indium Tin Oxide (ITO)</a> materials because it can be up to ninety percent (90%) transparent, allowing you to see the screen underneath without too much light loss. 
All capacitive sensing systems work by measuring a change in capacitance as a human interacts with the sensor, and they differ
in the method, or algorithm used to measure that capacitance. 
</p>

<h3>Surface Capacitance</h3>
<p>
Surface capacitance measurement (sometimes referred to as "active" capacitance measurement) is performed by the application
of a small voltage to the sensor, which creates a uniform electrostatic field. When a human comes into contact with the sensor,
(and hence the electrostatic field) a capacitor is formed dynamically. The capacitative sensor controller measures 
the change in capacitance to determine the proximity of the human within the electrostatic field.
</p>
  <img src="{{site.url.images}}/news/caps/surface_cap.png" alt="Surface Capacitance" title="Surface Capacitance"/>
<p>
The <a href="http://playground.arduino.cc//Main/CapacitiveSensor?from=Main.CapSense">Arduino Capacitive Sensing Library</a>
employs Surface Capacitive sensing (i.e. active sensing), and this requires two (2) pins per sensor element.
The Arduino drives the send pin (TX) to a new value, and then the Arduino counts the time 
the until the receive pin (RX) reaches that same value.
The change in capacitance due the presense of a human/finger varies the time for the receive pin (RX) to reach it's final value.
Because this type of capacitive sensor requires two (2) pins per element, most commercial sensor solutions 
are moving away from the Surface Capacitance types, in favor of Projected Capacitance solutions, which typically require
only a single pin per sensor element.
</p>
<h3>Projected Capacitance (Mutual Capacitance)</h3>
<p>
Projected Mutual Capacitance is typically used for touch screen applications, 
where perpendicual layers of conductive material form an X-Y grid of electrodes
(typically composed of <a href="http://en.wikipedia.org/wiki/Indium_tin_oxide">Indium Tin Oxide</a> material). 
The capacitance is measured  (usually by scanning the rows and columns over time) 
to locate one (or more) fingers within the X-Y grid space.
</p>
   <img src="{{site.url.images}}/news/caps/ito.png" alt="Projected Mutual Capacitance" title="Projected Mutual Capacitance"/>
<p>
Most of the so-called "multi-touch" systems that allow multiple fingers to be detected are using Projected Mutual Capacitance.
We'll be covering this in more detail when we get to Graphic LCD display systems and touch screen overlays.
Today we are concentrating on the types of capacitive sensors that can be implemented on your printed circuit boards.
</p>
   <img src="{{site.url.images}}/news/caps/ito_layers.png" alt="ITO Layers" title="ITO Layers"/>
</ul>
<h3>Projected Capacitance (Self Capacitance)</h3>
<p>
In Projected Self Capacitance, the sensor forms an intrinsic parasitic capacitance (Ci) by coupling with the surrounding ground pattern
on the printed circuit board.  When a human finger is in close proximity to the sensor pad, it alters the electric field
to add an additional capacitance (Cf) to the sensor, which can be measured by the capacitative sensor controller.
Once a pre-determined increase in capacitance is measured, the sensor is considered activated.
These are also sometimes refered to as "passive capacitance sensors".
</p>
  <img src="{{site.url.images}}/news/caps/cap_self.png" alt="Projected Self Capacitance" title="Projected Self Capacitance"/>
<p>
The sensors are continuously scanned, and when the baseline values are exceeded by a pre-determined threshold,
the sensor is considered to be activated  (ie. the button is pressed).
</p>
   <img src="{{site.url.images}}/news/caps/cap_self_section.png" alt="Projected Self Capacitance Sections" title="Projected Self Capacitance Sections"/>
<p>
Today we will be concentrating on Projected Self Capacitance (i.e. Passive) solutions for implementing 
buttons, sliders, dials, proximity, and other sensor patterns using only shapes of copper on your circuit boards. 
Basically, we are going to show you how to add control surfaces to your projects with almost no additional cost,
and greatly increased reliability compared to mechanical buttons, potentiometers, or rotary encoders.
</p>
<h3>Capacitive Sensing Algorithms</h3>
<p>
There are many different algorithms for measuring capacitance :

<ul>
	<li>ADC : where a current source generates a voltage charging ramp on a capacitor that can be sampled using an Analog to Digital Converter (ADC)
	<li>TX/RX : were a tranmitted (TX) source waveform is coupled using via mutual capacitance and sensed on the receiving (RX) end 
	<li>Charge Transfer : where the capacitive change to a sensor modifies the charge transfer on the sensor when measured against a reference capacitor 
	<li>Relaxation Oscillator : where a sensor capacitance is used to modify the frequency of an oscillator
</ul>
as well as different circuit implementations of each of these algorithms.
</p>
<h4>Relaxation Oscillator</h4>
<p>
In a <a href="http://en.wikipedia.org/wiki/Relaxation_oscillator">relaxation oscillator</a> based system the circuit forms a type of oscillator, 
where the change in capacitance of the sensor modifies the frequency of the oscillator, according to : &nbsp;
   <img src="{{site.url.images}}/news/caps/time_constant.png" alt="Time Constant" title="Time Constant"/>
</p>
<p>
When a <a href="http://en.wikipedia.org/wiki/Relaxation_oscillator">relaxation oscillator</a> is employed, it is based upon the behavior of a physical system's return to equilibrium after being disturbed (i.e. the finger entering the electrostatic field is the disturbance).
In most microprocessor based implementations that include a comparator on the input, the relaxation oscillator would look like :
  <img src="{{site.url.images}}/news/caps/220px-OpAmpHystereticOscillator.png" alt="Relax!" title="Relax!"/>
</p>
<h4>ADC Algorithms</h4>
<p>
There are several variations of the Analog to Digital Converter (ADC) capacitive measurement algorithms,
and those are usually dependent on the type of ADC employed; namely Capacitive Successive Approximation (CSA),
Capacitive Sigma Delta Modulator (CSD),and several others. In general, Capacitive Successive Approximation (CSA)
work better in the presence of Radio Frequency (RF) interfere, than the Capacitive Sigma Delta Modulator (CSD)
implementation.
</p>
   <img src="{{site.url.images}}/news/caps/raw_counts.png" alt="Raw Capacitance Sensor Counts" title="Raw Capacitance Sensor Counts"/>
<p>
In all cases the raw sensor input is converted to a number of counts, where a threshold of counts is used 
to determine when a button has been activated/pressed.
</p>

<h3>An Example Radial Slider Pattern</h3>
<p>
In the next segment, on the 
<a href="/news/2013/11/24/eagle-touch-widgets-library.html" title="Eagle Touch Widgets Library">PatternAgents Touch Widgets Library for Eagle</a>
we will be covering all the <a href="http://freedomdefined.org/OSHW">open source hardware (OSHW)</a> 
capacitive touch widgets that we have released on our Github repository.
Below is a simple example of a Radial Slider Pattern with two (2) buttons on an Arduino form factor board.
Note that this shield board is comprised of just the sensors themselves, and assumes the capacitive sensing controller device
is located on another board in the stack-up.
</p>
	<img src="{{site.url.images}}/news/caps/eagleUp_touch_test_radial_board_top.png" alt="Radial Test Board (top view)" title="Radial Test Board (top view)"/>
<p>
This is an example of what the top and bottom layers of the board would look like, rendered here in black and white 
so that you can see the ground plane hatch patterns (i.e. the copper pour)  more easily.
</p>
<ul class="illo-list">
  <li>
    <span>
      <img src="{{site.url.images}}/news/caps/eagleUp_touch_test_radial_top.png" alt="Radial Test Board (top view)" title="Radial Test Board (top view)"/>
    </span>
  </li>
  <li>
    <span>
      <img src="{{site.url.images}}/news/caps/eagleUp_touch_test_radial_bottom.png" alt="Radial Test Board (bottom view)" title="BRadial Test Board (bottom view)"/>
    </span>
  </li>
</ul>
<p>Thanks for joining us, and come back for the next section where we'll discuss the details of the 
<a href="/news/2013/11/24/eagle-touch-widgets-library.html" title="Eagle Touch Widgets Library">PatternAgents Touch Widgets Library for Eagle</a> 
and how you can download and use it to make your own capacitive sensing control surfaces.
</p>
